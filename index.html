<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>é€šçŸ¥è¨­å®šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background-color: #f9f9f9; }
    h1 { font-size: 24px; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 16px; margin: 12px 0; }
    .setting-row { display: flex; justify-content: space-between; align-items: center; margin: 8px 0; }
    .edit-btn { background-color: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
    .edit-btn:hover { background-color: #0056b3; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); }
    .modal-content { background-color: #fff; margin: 10% auto; padding: 20px; width: 90%; max-width: 400px; border-radius: 10px; }
    .modal-actions { display: flex; justify-content: space-between; margin-top: 16px; }
    .status-block { margin-left: 16px; font-size: 14px; color: #555; }
    select, input[type="text"] { width: 100%; margin: 5px 0; padding: 4px; }
  </style>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    let userId = null;
    const GAS_DEPLOYED_URL = "https://script.google.com/macros/s/YOUR_DEPLOYED_URL/exec";

    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      userId = params.get('userId');
      console.log('å–å¾—ã—ãŸuserId:', userId);
    });

    function openModal(type) {
      document.getElementById(`modal-${type}`).style.display = 'block';
    }
    function closeModal(type) {
      document.getElementById(`modal-${type}`).style.display = 'none';
    }

    function saveSettings() {
      const toggle = document.getElementById('laundry-toggle-select').value;
      const hour = document.getElementById('hour-select').value;
      const minute = document.getElementById('minute-select').value;
      const zip = document.getElementById('zip-code').value;
      const days = [...document.querySelectorAll('#modal-laundry input[type="checkbox"]:checked')].map(cb => cb.value);

      if (!/^[0-9]{7}$/.test(zip)) {
        alert("éƒµä¾¿ç•ªå·ã¯7æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      document.getElementById('laundry-toggle').innerText = toggle;
      document.getElementById('laundry-time-status').innerText = `${hour}:${minute}`;
      document.getElementById('laundry-days-status').innerText = days.join('') || 'æœªç™»éŒ²';
      document.getElementById('laundry-zip-status').innerText = zip;

      // GASã«é€ä¿¡
      const payload = {
        userId: userId,
        laundry: {
          on: toggle === "ON",
          hour: hour,
          minute: minute,
          days: days,
          zip: zip
        }
      };

      fetch(GAS_DEPLOYED_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message || "ä¿å­˜ã—ã¾ã—ãŸ");
        closeModal('laundry');
      })
      .catch(error => {
        console.error("é€ä¿¡å¤±æ•—:", error);
        alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");
      });
    }

    window.onload = () => {
      const hourSelect = document.getElementById('hour-select');
      const minuteSelect = document.getElementById('minute-select');
      for (let h = 0; h <= 23; h++) {
        hourSelect.innerHTML += `<option value="${h.toString().padStart(2, '0')}">${h.toString().padStart(2, '0')}</option>`;
      }
      for (let m = 0; m <= 55; m += 5) {
        minuteSelect.innerHTML += `<option value="${m.toString().padStart(2, '0')}">${m.toString().padStart(2, '0')}</option>`;
      }
    };
  </script>
</head>
<body>
<h1>ç¾åœ¨ã®é€šçŸ¥è¨­å®š</h1>
<div class="card">
  <div class="setting-row">
    <div>
      ğŸ§ºæ´—æ¿¯æŒ‡æ•°ï¼ˆ<span id="laundry-toggle">OFF</span>ï¼‰
      <div class="status-block">
        ãƒ»é€šçŸ¥æ™‚é–“ï¼š<span id="laundry-time-status">æœªç™»éŒ²</span><br/>
        ãƒ»é€šçŸ¥æ›œæ—¥ï¼š<span id="laundry-days-status">æœªç™»éŒ²</span><br/>
        ãƒ»éƒµä¾¿ç•ªå·ï¼š<span id="laundry-zip-status">æœªç™»éŒ²</span>
      </div>
    </div>
    <button class="edit-btn" onclick="openModal('laundry')">ç·¨é›†</button>
  </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal" id="modal-laundry">
  <div class="modal-content">
    <h2>æ´—æ¿¯æŒ‡æ•°ã®ç·¨é›†</h2>
    <label>é€šçŸ¥ON/OFFï¼š</label>
    <select id="laundry-toggle-select">
      <option value="ON">ON</option>
      <option value="OFF">OFF</option>
    </select><br/>
    <label>é€šçŸ¥æ™‚é–“ï¼š</label>
    <div style="display: flex; gap: 5px;">
      <select id="hour-select"></select>
      <select id="minute-select"></select>
    </div><br/>
    <label>é€šçŸ¥æ›œæ—¥ï¼š</label><br/>
    <label><input type="checkbox" value="æœˆ"/> æœˆ</label>
    <label><input type="checkbox" value="ç«"/> ç«</label>
    <label><input type="checkbox" value="æ°´"/> æ°´</label>
    <label><input type="checkbox" value="æœ¨"/> æœ¨</label>
    <label><input type="checkbox" value="é‡‘"/> é‡‘</label>
    <label><input type="checkbox" value="åœŸ"/> åœŸ</label>
    <label><input type="checkbox" value="æ—¥"/> æ—¥</label>
    <label><input type="checkbox" value="ç¥"/> ç¥</label><br/><br/>
    <label>éƒµä¾¿ç•ªå·ï¼ˆ7æ¡ã€æ•°å­—ã®ã¿ï¼‰ï¼š</label>
    <input id="zip-code" maxlength="7" placeholder="ä¾‹ï¼š1234567" type="text"/>
    <div class="modal-actions">
      <button onclick="saveSettings()">ä¿å­˜</button>
      <button onclick="closeModal('laundry')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
  </div>
</div>
</body>
</html>
